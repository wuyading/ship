<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
    <!--<![endif]-->
    <!-- BEGIN HEAD -->
    <include file="common:head" />
    <!-- END HEAD -->

    <body class="page-header-fixed page-sidebar-closed-hide-logo page-content-white">
        <!-- BEGIN HEADER -->
        <include file="common:header" />
        <!-- END HEADER -->
        <!-- BEGIN HEADER & CONTENT DIVIDER -->
        <div class="clearfix"> </div>
        <!-- END HEADER & CONTENT DIVIDER -->
        <!-- BEGIN CONTAINER -->
        <div class="page-container">
            <!-- BEGIN SIDEBAR -->
            <include file="common:sidebar" />
            <!-- END SIDEBAR -->

            <!-- BEGIN CONTENT -->
            <div class="page-content-wrapper">
                <!-- BEGIN CONTENT BODY -->
                <div class="page-content">
                    <!-- BEGIN PAGE HEADER-->
                    <!-- BEGIN PAGE BAR -->
                    <div class="page-bar">
                        <ul class="page-breadcrumb">
                            <li>
                                <a href="/index">首页</a>
                                <i class="fa fa-circle"></i>
                                <a href="#">用户操作日志</a>
                            </li>
                        </ul>
                    </div>
                    <!-- END PAGE BAR -->
                    <!-- END PAGE HEADER-->
                    <div class="row">
                        <div style="margin: 15px 15px 15px 0;">
                            <div style="margin-left:40px;display: inline-block">
                                <form method="get" action="/operate/lists" >
                                    开始时间：<input style=" width:200px;height:30px;line-height: 30px;" value="<?=$_GET['start_time']?$_GET['start_time']:'' ?>" class="laydate-icon" name="start_time" onclick="laydate()" type="text">
                                    截止时间：<input style=" width:200px;height:30px;line-height: 30px;" value="<?=$_GET['end_time']?$_GET['end_time']:'' ?>" class="laydate-icon" name="end_time" onclick="laydate()" type="text">
                                    <input type="submit" value="搜索">
                                </form>
                            </div>
                        </div>
                        <div class="col-md-12 col-sm-12">
                            <table class="table table-hover">
                                <tr>
                                    <th>编号</th>
                                    <th>操作内容</th>
                                    <th>操作者</th>
                                    <th>操作时间</th>
                                </tr>
                                <?php foreach ($list as $row):?>
                                <tr>
                                    <td><?=$row['id']?></td>
                                    <td><?=$row['content']?></td>
                                    <td><?=$row['username']['username']?></td>
                                    <td><?=date('Y-m-d',$row['add_time'])?></td>
                                </tr>
                                <?php endforeach; ?>
                            </table>
                            <div class="pagination">
                                <?=$page?>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- END CONTENT BODY -->
            </div>
            <!-- END CONTENT -->
        </div>
        <!-- END CONTAINER -->
        <!-- BEGIN FOOTER -->
        <include file="common:footer" />
        <script type="text/javascript" src="__PUBLIC__/laydate/laydate.js"></script>

        <script type="text/javascript">
        //修改密码
            function up_pwd(id) {
            $("#user_id").val(id);
            $('.up_pwd').modal('show');
        }

            $(".save_pwd").click(function () {
                if(confirm('确定提交吗？')){
                var data = $("#pwd_form").serialize();
                $.post('/member/ajax_save_user_pwd',data,function (res) {
                    if(res.status == 1001){
                        alert(res.message);
                        $('.up_pwd').modal('hide');
                    }else{
                        alert(res.message);
                    }
                },'json');
            }
        });

        //添加用户
        function add_user() {
            clear_checked();
            $('.add_user').modal('show');
        }

        $(".save_user").click(function () {
            if(confirm('确定提交吗？')){
                var data = $("#user_form").serialize();
                $.post('/member/ajax_save_user',data,function (res) {
                    if(res.status == 1001){
                        alert(res.message);
                        $('.up_pwd').modal('hide');
                        window.location.reload();
                    }else{
                        alert(res.message);
                    }
                },'json');
            }
        });

        //删除用户
        function delete_user(id,obj){
            layer.alert('确定删除吗？', {
                icon: 6
                ,time: 0 //不自动关闭
                ,btn: ['确定', '取消']
                ,area: '200px'
                ,yes: function(index){
                    layer.close(index);
                    $.post('{:U("member/delete_user")}',{'id':id},function (res) {
                        if(res.status == 1001){
                            layer.alert(res.message, {
                                icon: 6
                                ,time: 0 //不自动关闭
                                ,btn: ['确定']
                                ,area: '200px'
                                ,yes: function(index){
                                    layer.close(index);
                                    window.location.href="/member/lists";
                                }
                            });
                        }else{
                            layer.alert(res.message, {icon: 0,time:0,closeBtn: 0});
                        }
                    },'json');
                }
                ,no: function(index){
                    layer.close(index);
                }
            });
        }

        //修改权限
        function update_access(id,obj) {
            $("#m_id").val(id);
            clear_checked();

            var access = $(obj).attr('data-access');
            if(access){
                var data = eval("("+access+")");

                if(data){
                    if(data.b_access == 1){
                        $("#update_access_form").find('.b_access').prop('checked',true);
                        $("#update_access_form").find('.b_access').parent().attr('class','checked');
                    }
                    if(data.b_add == 1){
                        $("#update_access_form").find('.b_add').prop('checked',true);
                        $("#update_access_form").find('.b_add').parent().attr('class','checked');
                    }
                    if(data.u_add == 1){
                        $("#update_access_form").find('.u_add').prop('checked',true);
                        $("#update_access_form").find('.u_add').parent().attr('class','checked');
                    }
                }
            }

            $('.update_access').modal('show');
        }

        $(".save_update_access").click(function () {
            if(confirm('确定提交吗？')){
                var data = $("#update_access_form").serialize();
                $.post('/member/ajax_save_access',data,function (res) {
                    if(res.status == 1001){
                        alert(res.message);
                        $('.up_pwd').modal('hide');
                        window.location.reload();
                    }else{
                        alert(res.message);
                    }
                },'json');
            }
        });

        function clear_checked() {
            $('.b_access').attr('checked',false);
            $('.b_access').parent().attr('class','');

            $('.b_add').attr('checked',false);
            $('.b_add').parent().attr('class','');

            $('.u_add').attr('checked',false);
            $('.u_add').parent().attr('class','');
        }


    </script>
    </body>

</html>